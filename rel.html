<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Results Page</title>
</head>

<body>

  <h2>Diagnosis Results</h2>
  <div id="diagnosis-results"></div>

  <script>
 
  const symps = JSON.parse(localStorage.getItem("selectedSymptoms")) || [];
  const container = document.getElementById("diagnosis-results");

  if (symps.length === 0) {
    container.innerHTML = `<p class="message">No symptoms provided.</p>`;
  } else {
    diagnose();
  }

  async function diagnose() {
    container.innerHTML = `<div class="spinner"></div>`;

    try {
      const res = await fetch("http://localhost:3000/api/diagnose", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ symptoms: symps })
      });

      const data = await res.json();
      renderResults(data);

    } catch (err) {
      console.error(err);
      container.innerHTML = `<p class="message">⚠️ Backend not running on port 3000.</p>`;
    }
  }

  function renderResults(data) {
    container.innerHTML = "";

    if (!data.matches || data.matches.length === 0) {
      container.innerHTML = `<p class="message">No matching conditions found.</p>`;
      return;
    }

    data.matches.forEach(d => {
      const div = document.createElement("div");
      div.className = "result";
      div.innerHTML = `
        <strong>${d.name}</strong>
        <span>Matched symptoms: ${d.matchedSymptoms}</span>
      `;
      container.appendChild(div);
    });
  }

  </script>

  <style>
    body {
      font-family: sans-serif;
      background-image: linear-gradient(to top, rgba(0, 221, 255, 0.258), rgb(255, 255, 255));
      height: 100vh;
      overflow: hidden;
    }

    .result {
      background: #ffffff;
      padding: 10px;
      margin-bottom: 10px;
      border-radius: 8px;
      max-width: 30%;

    }
  </style>

</body>

</html>